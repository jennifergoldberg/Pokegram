<!DOCTYPE html>
<html lang="en">

<!-- Head Partial -->
<%- include("partials/_head.ejs") %>

  <body>
    <section>
      <!-- Nav Partial -->
      <%- include("partials/_nav.ejs") %>
    </section>
    <% post.slice().reverse().forEach(allPosts=> { %>
      <section>
        <div class="card mx-auto" style="width: 30rem;">
          <section id="index-card-top" class="top d-flex justify-content-between">
            <section class="d-flex align-items-center">
              <img class="post-avatar" src="<%= allPosts.avatar %> " alt="avatar" height="30px">
              <h5 class="post-user" style="font-family: 'Press Start 2P', cursive">
                <%= allPosts.username %>
              </h5>
            </section>
            <div class="dropdown d-flex">
              <a class="btn btn-link dropdown-toggle-split" href="#" role="button" id="dropdownMenuLink"
                data-bs-toggle="dropdown" aria-expanded="false">
                <svg class="dark" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-three-dots" viewBox="0 0 16 16">
                  <path
                    d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" />
                </svg>
              </a>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                <li><a class="dropdown-item" href="/posts/<%= allPosts._id%>/edit">Edit Post</a></li>
                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModal" href="#">Delete
                    Post</a></li>
              </ul>
            </div>
          </section>
          <a href="/posts/<%= allPosts._id%> ">
            <img class="card-img-top" src="<%= allPosts.image %>"></a>

          <div class="card-body">
            <section class="post-text, d-flex">

              <form action="/posts/likes/<%= allPosts._id %>?_method=PUT" method="POST">
                <%if (allPosts.likes !==false ) { %>
                  <button class="likes" type="submit" aria-expanded="false">
                    <img class="post-likes" style="cursor: pointer;" src="/assets/_Favourite.png" alt="like"
                      height="30px">
                  </button>
                  <% } else { %>
                    <button class="likes" type="submit" aria-expanded="false">
                      <img class="post-likes" style="cursor: pointer;" src="/assets/_heart-static.png" alt="like"
                        height="30px">
                    </button>
                    <% }; %>
              </form>
              <p class="indexCaption">
                <%= allPosts.text %>
              </p>
            </section>
            <ul class="list-group list-group-flush">
              <% comment.forEach(comments=> { %>
                <% if(comments.post==allPosts.id) { %>
                  <li class="list-group-item d-flex">
                    <strong>
                      <section class="me-auto">
                        <%= comments.username %>
                    </strong>
                    <span class="comment-text-space"> <%= comments.text %> </span>
      </section>
      <form action="posts/comments/likes/<%= comments._id %>?_method=PUT" method="POST">
        <%if (comments.likes !==false ) { %>
          <button class="likes" type="submit">
            <img class="post-likes" style="cursor: pointer;" src="/assets/_Favourite.png" alt="like" height="30px">
          </button>
          <% } else { %>
            <button class="likes" type="submit">
              <img class="post-likes" style="cursor: pointer;" src="/assets/_heart-static.png" alt="like" height="30px">
            </button>
            <% }; %>
      </form>
      </li>
      <% } %>
        <% }); %>
          </ul>
          <a href="/posts/<%= allPosts._id%> " class="btn btn-primary justify-content-around">Comment on this post</a>
          </div>
          </div>
          </section>
          <!-- Delete Modal -->

          <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Delete Post</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  Are you sure you want to delete this post?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <form action="/posts/<%= allPosts._id %>?_method=DELETE" method="POST">
                    <input type="submit" class="btn btn-primary" value="Delete">
                  </form>
                </div>
              </div>
            </div>
          </div>
          <% });%>
  </body>

</html>